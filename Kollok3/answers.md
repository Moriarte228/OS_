# Классические поведенческие шаблоны проектирования: Команда, Стратегия, Шаблонный метод

## Архитектура ПО и влияние многопоточности

**Архитектура программного обеспечения (ПО)** — фундаментальная структура системы, описывающая её компоненты, связи и поведение. Архитектура задаёт каркас для разработки, поддержки и масштабирования ПО.

Многопоточность в архитектуре требует:
- Управления состояниями и синхронизации для предотвращения ошибок гонки данных;
- Безопасного разделения ресурсов или использования безблокирующих структур данных;
- Поддержки паттернов, обеспечивающих согласованность в параллельных потоках;
- Учёта сложности тестирования и отладки.

---

## Шаблон «Команда» (Command)

### Определение
Инкапсулирует запрос в виде объекта, позволяя отделить отправителя запроса от получателя, поддерживать очереди, логирование и отмену операций.

### Проблемы
- Тесная связь отправителя и получателя запроса.
- Отсутствие возможности универсально управлять вызовами.
- Неудобство реализации отмены и повторного выполнения операций.

### Решение
- Создать объект-команду, содержащий все данные и логику запроса.
- Использовать единый интерфейс команд.
- Разделить отправителя и исполнителя команды.

### Инкапсуляция
Команда инкапсулирует действия и параметры, отделяя вызов от выполнения.

### Разделяй и властвуй
Роли отправителя, команды и получателя чётко разделены для упрощения поддержки.

### Ортогональность
Команды независимы и могут комбинироваться.

### Влияние многопоточности
- Использование очередей команд для асинхронной обработки.
- Требуется синхронизация общего состояния.
- Подходит для реализации пулов потоков и отложенного выполнения.

### Примеры использования
- Undo/Redo в редакторах.
- Асинхронное выполнение задач.
- Отложенное выполнение команд по расписанию.

---

## Шаблон «Стратегия» (Strategy)

### Определение
Инкапсулирует семейство алгоритмов, позволяя взаимозаменять их во время выполнения.

### Проблемы
- Жёсткое связывание клиента с конкретным алгоритмом.
- Избыточные условные конструкции для выбора поведения.

### Решение
- Выделить интерфейс стратегии.
- Реализовать различные алгоритмы в отдельных классах.
- Клиент взаимодействует с абстракцией стратегии.

### Инкапсуляция
Алгоритмы инкапсулированы в независимых классах.

### Разделяй и властвуй
Изменение и расширение алгоритмов происходит без изменения клиента.

### Ортогональность
Стратегии полностью независимы.

### Влияние многопоточности
- Стратегии должны быть потокобезопасными или использоваться по экземплярам.
- Замена стратегий в потоках требует синхронизации.

### Примеры использования
- Разные алгоритмы сортировки.
- Выбор политики кэширования.
- Различные способы оплаты.

---

## Шаблон «Шаблонный метод» (Template Method)

### Определение
Определяет скелет алгоритма в базовом классе, а детали реализации оставляет подклассам.

### Проблемы
- Необходимость повторного использования общего алгоритма с вариациями.
- Избежание дублирования кода.

### Решение
- Определить фиксированную последовательность вызовов в шаблонном методе.
- Подклассы реализуют конкретные шаги.

### Инкапсуляция
Общий алгоритм и вариации разделены между базовым классом и наследниками.

### Разделяй и властвуй
Чёткое разделение неизменной и изменяемой части алгоритма.

### Ортогональность
Вариации реализуются независимо.

### Влияние многопоточности
- Потокобезопасность реализации шаблонного метода.
- Управление состоянием и синхронизация при работе с ресурсами.

### Примеры использования
- Обработка данных (чтение, преобразование, сохранение).
- Жизненный цикл объектов во фреймворках.
- Тестовые фреймворки с переопределяемыми этапами.

---

## Итоговая таблица

| Шаблон          | Проблема                                   | Решение                                  | Влияние многопоточности             |
|-----------------|-------------------------------------------|-----------------------------------------|------------------------------------|
| Команда         | Связь вызова и выполнения операции        | Инкапсуляция запроса в объект-команду  | Очереди команд, синхронизация      |
| Стратегия       | Жёсткое связывание клиента с алгоритмом   | Инкапсуляция алгоритмов в отдельные классы | Потокобезопасность стратегий       |
| Шаблонный метод | Общий алгоритм с вариациями                | Шаблонный метод с переопределяемыми шагами | Управление состоянием, синхронизация|

---

*Данные шаблоны проектирования обеспечивают гибкость, расширяемость и поддерживаемость систем, особенно в условиях многопоточной архитектуры.*
